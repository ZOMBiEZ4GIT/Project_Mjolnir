{
  "project": "Mjolnir",
  "branchName": "ralph/ux8-live-price-ui",
  "description": "UX-8: Live Price UI — Create clear visual feedback for live price updates and refresh states. Price update flash animations, NumberTicker integration, refresh progress counter, polished timestamps with tooltips, inline retry buttons, loading skeletons, and design token treatment.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add price update flash animation",
      "description": "As a user, I want to see a brief colour flash when a price changes so I notice which holdings just updated.",
      "acceptanceCriteria": [
        "Create components/holdings/price-flash.tsx — a wrapper component that flashes on value change",
        "Props: value: number, children: ReactNode, className?: string",
        "On value increase: brief green flash (bg-positive/20 → transparent, 400ms)",
        "On value decrease: brief red flash (bg-destructive/20 → transparent, 400ms)",
        "No change: no flash",
        "Flash uses CSS transition or Framer Motion animate — not a full re-render",
        "Tracks previous value via useRef to detect direction of change",
        "Flash only triggers on actual value change, not on initial mount",
        "Respects prefers-reduced-motion — no flash, just update the value",
        "Typecheck passes (npm run build)"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Integrate NumberTicker into price cells",
      "description": "As a user, I want price values to animate smoothly when they change so updates feel dynamic rather than jarring.",
      "acceptanceCriteria": [
        "Update PriceCell in components/holdings/holdings-table.tsx to use NumberTicker for main price display",
        "NumberTicker animates digits when price value changes (on manual refresh or background refresh)",
        "On initial load: NumberTicker counts up from 0 to the price value (600ms)",
        "On price update: NumberTicker morphs from old value to new value (400ms)",
        "Price formatted with currency symbol prefix (A$, NZ$, US$) — prefix does not animate, only digits",
        "Wrap NumberTicker in PriceFlash (US-001) so both digit animation and colour flash happen together",
        "Change percentage text (+1.23%) also updates with brief crossfade (150ms)",
        "Performance: NumberTicker in table rows must not cause jank — use will-change: transform on digit slots",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Enhance refresh button with progress counter",
      "description": "As a user, I want to see how many prices have been fetched during a refresh so I know the progress.",
      "acceptanceCriteria": [
        "Update refresh button in components/dashboard/dashboard-header.tsx",
        "While refreshing, button text shows: 'Refreshing X/Y...' where X = completed, Y = total tradeable holdings",
        "Simpler alternative: show 'Refreshing...' with count of total holdings, then on completion show count in toast",
        "RefreshCw icon continues to spin (animate-spin) during refresh",
        "Button disabled during refresh (current behaviour preserved)",
        "On completion: button returns to default 'Refresh' state",
        "Toast on completion: 'Refreshed X prices' (success) or 'Refreshed X prices, Y failed' (partial failure)",
        "Uses design tokens for button styling",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Polish last-updated timestamps with tooltips",
      "description": "As a user, I want to see when each price was last updated with clear relative time and exact time on hover.",
      "acceptanceCriteria": [
        "Create components/holdings/price-timestamp.tsx — dedicated timestamp display component",
        "Props: fetchedAt: Date | null, isStale: boolean, error?: string",
        "Displays relative time: 'just now', '2 min ago', '1 hour ago', '3 days ago'",
        "Relative time auto-updates every 30 seconds (use useEffect with interval)",
        "Tooltip (shadcn/ui Tooltip) shows exact timestamp: 'Feb 5, 2026, 3:42:15 PM AEST'",
        "Fresh state: Clock icon + relative time in text-muted-foreground",
        "Stale state: AlertTriangle icon in text-warning (amber) + relative time in text-warning",
        "Error state: AlertTriangle icon in text-destructive + relative time + '(failed)' suffix",
        "No timestamp (null): shows '—' with no tooltip",
        "Replace inline timestamp logic in PriceCell with this component",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Polish inline retry button for failed prices",
      "description": "As a user, I want a clear, polished retry button when a price fetch fails so I can easily try again.",
      "acceptanceCriteria": [
        "Update retry button UI within PriceCell in components/holdings/holdings-table.tsx",
        "Retry button: small pill-shaped button (rounded-full px-2 py-0.5) with RotateCw icon + 'Retry' text",
        "Default state: bg-muted text-muted-foreground with hover:bg-accent/20 hover:text-foreground",
        "Retrying state: RotateCw icon spins (animate-spin), text changes to 'Retrying...', button disabled",
        "On success: button disappears, price cell updates with flash animation (US-001)",
        "On failure: button returns to default state, toast shows 'Failed to refresh [holding name]'",
        "Button has subtle entrance animation (fade in) when error state appears",
        "Button has exit animation (fade out) when price successfully refreshes",
        "Uses design tokens throughout",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create price cell loading skeleton",
      "description": "As a user, I want a shaped loading skeleton in price cells while prices are being fetched so the layout feels stable.",
      "acceptanceCriteria": [
        "Create loading skeleton variant for price cell area",
        "Skeleton shows: price placeholder (wider bar) + change percentage placeholder (narrower bar) + timestamp placeholder (narrow bar)",
        "Skeleton uses animate-pulse with bg-muted (design tokens, not hardcoded bg-gray-*)",
        "Skeleton dimensions match typical rendered price cell content to prevent layout shift",
        "Replace current 'Loading...' text in PriceCell with skeleton",
        "Skeleton also used for MarketValueCell and GainLossCell when prices are loading",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Polish stale price visual treatment",
      "description": "As a user, I want stale prices to be visually distinct so I can tell at a glance which prices are outdated.",
      "acceptanceCriteria": [
        "Update PriceCell styling for stale prices: price value text uses text-muted-foreground (dimmed)",
        "Subtle amber left border on price cell area (border-l-2 border-warning/50)",
        "Timestamp shows amber warning styling (handled by PriceTimestamp US-004)",
        "Stale price still shows cached value (not hidden or replaced)",
        "Stale state determined by isStale flag from API (>15 minute cache TTL)",
        "When price refreshes and becomes fresh: stale styling removes with smooth transition (200ms)",
        "Fresh → stale transition happens automatically as relative time updates",
        "Uses design tokens: text-warning for amber accents",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add change indicator animations to price cells",
      "description": "As a user, I want the price change indicator (arrow + percentage) to animate when values update.",
      "acceptanceCriteria": [
        "Update change percentage display in PriceCell",
        "Positive change: TrendingUp icon + percentage in text-positive",
        "Negative change: TrendingDown icon + percentage in text-destructive",
        "Zero/no change: Minus icon + '0.00%' in text-muted-foreground",
        "On price update, if direction changes (positive → negative or vice versa): icon crossfades (150ms, AnimatePresence)",
        "Absolute change value in parentheses: text-muted-foreground",
        "Replace hardcoded text-green-* and text-red-* with text-positive and text-destructive",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Polish dashboard refresh integration",
      "description": "As a user, I want the dashboard header refresh to feel connected to the price cells below.",
      "acceptanceCriteria": [
        "When refresh starts: all price cells in holdings table show brief 'refreshing' indicator (subtle shimmer or pulse, 1 cycle, animate-pulse)",
        "Indicator is subtle — not as prominent as full loading skeleton",
        "As prices return from API: each price cell updates individually with flash + NumberTicker animation",
        "Updated cells stop pulsing",
        "On refresh completion: all timestamps reset to 'just now', toast confirms completion",
        "Background auto-refresh uses same visual treatment but no toast",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Replace hardcoded colours across price UI components",
      "description": "As a developer, I want all price-related components using design system tokens.",
      "acceptanceCriteria": [
        "Audit and update price-related UI in: holdings-table.tsx (PriceCell, MarketValueCell, GainLossCell, CostBasisCell), dashboard-header.tsx (refresh button), stale-data-warning.tsx, app/(dashboard)/holdings/page.tsx",
        "Replace: text-white → text-foreground, text-gray-* → text-muted-foreground, text-green-* → text-positive, text-red-* → text-destructive, text-yellow-*/text-amber-* → text-warning",
        "Replace: bg-gray-* → bg-card/bg-muted/bg-background, border-gray-* → border-border",
        "Replace: bg-yellow-900/20 → bg-warning/10, border-yellow-600/50 → border-warning/30",
        "Visual appearance preserved or improved",
        "Typecheck passes (npm run build)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    }
  ]
}
