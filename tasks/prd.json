{
  "project": "Mjolnir",
  "branchName": "feature/w11-data-import",
  "description": "CSV data import for transactions and snapshots, allowing Roland to bulk import historical data with idempotent processing.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create CSV parsing utility",
      "description": "As a developer, I need a utility to parse CSV files.",
      "acceptanceCriteria": [
        "Create lib/import/csv-parser.ts",
        "Function parseCSV(content: string) returns array of objects",
        "Handles headers, quoted values, and newlines in fields",
        "Returns typed rows with column names as keys",
        "Handles empty values as null",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Create transaction import validator",
      "description": "As a developer, I need to validate transaction CSV rows.",
      "acceptanceCriteria": [
        "Create lib/import/validators/transaction-validator.ts",
        "Validates required fields: date, symbol, action, quantity, unit_price",
        "Validates action is BUY, SELL, or DIVIDEND",
        "Validates quantity and unit_price are positive numbers",
        "Returns { valid: boolean, errors: string[], data: TransactionRow }",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create snapshot import validator",
      "description": "As a developer, I need to validate snapshot CSV rows.",
      "acceptanceCriteria": [
        "Create lib/import/validators/snapshot-validator.ts",
        "Validates required fields: date, fund_name, balance",
        "Optional fields: employer_contrib, employee_contrib, currency",
        "Validates balance is a number",
        "Returns { valid: boolean, errors: string[], data: SnapshotRow }",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create transaction import service",
      "description": "As a developer, I need a service to import transactions.",
      "acceptanceCriteria": [
        "Create lib/import/transaction-importer.ts",
        "Function importTransactions(userId, rows) processes validated rows",
        "Creates or finds holding by symbol (auto-creates if not exists)",
        "Checks for duplicate transactions (same date, symbol, action, quantity)",
        "Returns { imported: number, skipped: number, errors: ImportError[] }",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create snapshot import service",
      "description": "As a developer, I need a service to import snapshots.",
      "acceptanceCriteria": [
        "Create lib/import/snapshot-importer.ts",
        "Function importSnapshots(userId, rows) processes validated rows",
        "Creates or finds holding by fund_name (auto-creates if not exists)",
        "Checks for duplicate snapshots (same holding + date)",
        "Creates contributions record if employer/employee contrib provided",
        "Returns { imported: number, skipped: number, errors: ImportError[] }",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create import API endpoint for transactions",
      "description": "As a developer, I need an API endpoint for transaction imports.",
      "acceptanceCriteria": [
        "Create app/api/import/transactions/route.ts",
        "POST accepts multipart form data with CSV file",
        "Parses CSV, validates rows, imports valid transactions",
        "Returns summary: { total, imported, skipped, errors }",
        "Requires Clerk authentication",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create import API endpoint for snapshots",
      "description": "As a developer, I need an API endpoint for snapshot imports.",
      "acceptanceCriteria": [
        "Create app/api/import/snapshots/route.ts",
        "POST accepts multipart form data with CSV file",
        "Parses CSV, validates rows, imports valid snapshots",
        "Returns summary: { total, imported, skipped, errors }",
        "Requires Clerk authentication",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Create file upload component",
      "description": "As Roland, I want to upload CSV files easily.",
      "acceptanceCriteria": [
        "Create components/import/file-upload.tsx",
        "Drag-and-drop zone for CSV files",
        "Click to browse files option",
        "Shows file name after selection",
        "Validates file is .csv type",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Create import results component",
      "description": "As Roland, I want to see import results clearly.",
      "acceptanceCriteria": [
        "Create components/import/import-results.tsx",
        "Shows imported count (green), skipped count (yellow), error count (red)",
        "Expandable error list showing row number and error message",
        "Success state shows check icon",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Create import page",
      "description": "As Roland, I want a dedicated page to import data.",
      "acceptanceCriteria": [
        "Create app/(dashboard)/import/page.tsx",
        "Add Import link to dashboard navigation",
        "Two sections: Import Transactions, Import Snapshots",
        "Each section has FileUpload and ImportResults components",
        "Shows CSV format examples for each type",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add import progress indicator",
      "description": "As Roland, I want to see import progress for large files.",
      "acceptanceCriteria": [
        "Add loading state to import process",
        "Show progress bar during import",
        "Disable upload button while importing",
        "Show 'Processing X rows...' message",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add CSV template downloads",
      "description": "As Roland, I want to download CSV templates.",
      "acceptanceCriteria": [
        "Add 'Download Template' button for transactions",
        "Add 'Download Template' button for snapshots",
        "Templates include header row and example data row",
        "Files named transactions-template.csv and snapshots-template.csv",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add import history tracking",
      "description": "As a developer, I need to track import history.",
      "acceptanceCriteria": [
        "Create import_history table: id, user_id, type, filename, total, imported, skipped, errors_json, created_at",
        "Generate migration with npm run db:generate",
        "Save import record after each import completes",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Show recent imports on import page",
      "description": "As Roland, I want to see my recent imports.",
      "acceptanceCriteria": [
        "Add Recent Imports section to import page",
        "Shows last 5 imports with: date, type, filename, results",
        "Clicking shows full error details if any",
        "Empty state if no imports yet",
        "Typecheck passes",
        "Lint passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    }
  ]
}
