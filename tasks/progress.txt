## Codebase Patterns
- Project uses Next.js 16+ App Router with TypeScript
- Drizzle ORM is already installed (`drizzle-orm`, `drizzle-kit`, `@neondatabase/serverless`)
- shadcn/ui components available in `components/ui`
- Dark mode only - no light mode support
- Quality checks: `npm run build` and `npm run lint`
- ESLint 9 with flat config format (eslint.config.mjs) - do not use .eslintrc.json
- Next.js 16 doesn't have `next lint` command - use `eslint .` directly

- Database module uses lazy initialization via Proxy to avoid build-time errors when DATABASE_URL is not set
- ClerkProvider conditionally renders based on NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY to allow builds without Clerk keys
- Use `export const dynamic = "force-dynamic"` for pages/layouts that use Clerk components
- Dashboard routes at `/dashboard` and `/profile` are protected; landing page `/` is public
- Auth pages use `(auth)` route group; dashboard uses `(dashboard)` route group

- TanStack Query provider is in `components/providers/query-provider.tsx` - wrap layouts with QueryProvider
- ClerkProvider wrapper is in `components/providers/clerk-provider.tsx` - handles missing Clerk keys gracefully
- Use `useAuthSafe` hook from `lib/hooks/use-auth-safe.ts` for client-side auth state that works with/without Clerk

- Toast notifications use Sonner - import `toast` from `sonner` and use `toast.success()` / `toast.error()`
- Toaster component is in root layout; for dark mode only, hardcode `theme="dark"` in Sonner component

- Dashboard navigation uses `components/dashboard/nav.tsx` with usePathname for active state
- Settings page exists at `/settings` for user preferences
- Import page exists at `/import` for CSV imports

- Error Handling Patterns (from CLAUDE.md):
  - Price API down: Show last cached price with "as of X ago" badge
  - Unknown symbol: Show error on holding form, prevent save
  - Invalid ticker: Show validation error, suggest correct format (e.g., `.AX` for ASX)
  - Auth failure: Redirect to Clerk sign-in
  - DB error: Generic "something went wrong" + error logging

- Design Principles:
  - Dark mode only - no light mode
  - Information density - show meaningful data; minimize empty space
  - Scannable - key metrics visible without scrolling
  - Mobile responsive - usable on phone for quick balance checks

- Existing components:
  - shadcn/ui: Button, Input, Select, Table, Card, Progress, Tooltip, Switch, Dialog, Sheet
  - Chart components in `components/charts/`: ChartSkeleton, ChartError, ChartExportButton
  - Dashboard components with loading skeletons already implemented

- Tailwind responsive breakpoints: sm (640px), md (768px), lg (1024px), xl (1280px)
- Use responsive classes like `hidden md:block` or `grid-cols-1 md:grid-cols-2`

---

# W-12 Polish & Error Handling Progress Log

Started: 2026-02-03

---

