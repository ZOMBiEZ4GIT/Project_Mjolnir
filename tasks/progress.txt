## Codebase Patterns
- Project uses Next.js 16+ App Router with TypeScript
- Drizzle ORM is already installed (`drizzle-orm`, `drizzle-kit`, `@neondatabase/serverless`)
- shadcn/ui components available in `components/ui`
- Dark mode only - no light mode support
- Quality checks: `npm run build` and `npm run lint`
- ESLint 9 with flat config format (eslint.config.mjs) - do not use .eslintrc.json
- Next.js 16 doesn't have `next lint` command - use `eslint .` directly

- Database module uses lazy initialization via Proxy to avoid build-time errors when DATABASE_URL is not set
- ClerkProvider conditionally renders based on NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY to allow builds without Clerk keys
- Use `export const dynamic = "force-dynamic"` for pages/layouts that use Clerk components
- Dashboard routes at `/dashboard` and `/profile` are protected; landing page `/` is public

- TanStack Query provider is in `components/providers/query-provider.tsx` - wrap layouts with QueryProvider
- ClerkProvider wrapper is in `components/providers/clerk-provider.tsx` - handles missing Clerk keys gracefully
- Use `useAuthSafe` hook from `lib/hooks/use-auth-safe.ts` for client-side auth state that works with/without Clerk

- Toast notifications use Sonner - import `toast` from `sonner` and use `toast.success()` / `toast.error()`
- Toaster component is in root layout; for dark mode only, hardcode `theme="dark"` in Sonner component

- Dashboard navigation uses `components/dashboard/nav.tsx` with usePathname for active state
- Navigation items array can be extended with new pages (Import and Export pages follow same pattern)

- Existing database schemas in `lib/db/schema.ts`:
  - holdings: id, name, symbol, type, currency, exchange, is_dormant, user_id, created_at, deleted_at
  - transactions: id, holding_id, date, action, quantity, unit_price, fees, currency, notes
  - snapshots: id, holding_id, date, balance, currency
  - contributions: id, holding_id, date, employer_contrib, employee_contrib

- Import utilities in `lib/import/`:
  - csv-parser.ts - parseCSV function
  - transaction-importer.ts - importTransactions
  - snapshot-importer.ts - importSnapshots
  - validators/ - transaction and snapshot validators

- File download pattern (from import page templates):
  - Create Blob with content and MIME type
  - Use URL.createObjectURL and temporary anchor element
  - Set download attribute for filename
  - Click programmatically and revoke object URL

- API response patterns:
  - For file downloads: set Content-Type and Content-Disposition headers
  - Return new Response(content, { headers })
  - CSV MIME type: "text/csv;charset=utf-8"
  - JSON MIME type: "application/json"

---

# W-13 Data Export Progress Log

Started: 2026-02-03

---

