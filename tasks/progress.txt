## Codebase Patterns
- Project uses Next.js 14+ App Router with TypeScript
- Drizzle ORM is already installed (drizzle-orm, drizzle-kit, @neondatabase/serverless)
- shadcn/ui components available in components/ui
- Dark mode only - no light mode support
- Quality checks: `npm run build` and `npm run lint`
- ESLint 9 with flat config format (eslint.config.mjs) - do not use .eslintrc.json
- Tailwind CSS with shadcn/ui CSS variable pattern using HSL format: hsl(var(--variable))
- CSS variables stored without hsl() wrapper e.g. --background: 240 10% 3.9%
- Glow shadows use rgba() since HSL variables can't express box-shadow alpha
- Inter font loaded via next/font/google in app/layout.tsx (applied via inter.className on body)
- Framer Motion components require "use client" directive
- Toast notifications use Sonner - import toast from sonner
- Dashboard navigation uses components/dashboard/nav.tsx with usePathname for active state
- Tailwind has semantic tokens: text-positive/bg-positive (green), text-negative/bg-negative (red), shadow-glow-sm/md/lg, shadow-glow-positive, shadow-glow-negative, shadow-card, shadow-card-hover
- Layout & spacing constants live in lib/theme.ts (sidebarWidth, cardRadius, spacing xs→2xl) — use instead of magic numbers
- Animation presets live in lib/animations.ts — import and spread onto motion.div elements (e.g. `<motion.div {...fadeIn}>`)
- Stagger presets (staggerContainer, staggerItem) use Variants type with "hidden"/"visible" keys — use with variants prop
- numberSpring is a Transition object for animating numeric values (e.g. useSpring, useMotionValue)
- Reduced motion: use `useAnimationConfig(preset?)` from hooks/use-animation-config.ts — returns props that disable animations when OS prefers-reduced-motion is on
- Hooks live in hooks/ directory (not lib/) — follow this convention for custom React hooks
- Recharts SVG props (stroke, fill) require raw hex values — CSS variables not supported in SVG rendering
- Category indicator colours (asset types, currencies) use hardcoded Tailwind colours (bg-blue-500 etc.) — these are intentional and distinct from theme tokens
- Card container pattern: `border-border bg-card/50` for bordered cards, `bg-muted` for skeleton placeholders
- Error state pattern: `border-destructive bg-destructive/10` with `text-destructive` for error messages
- Toggle pattern: active=`bg-muted text-foreground`, inactive=`text-muted-foreground hover:text-foreground`
- Form validation pattern: `border-destructive focus-visible:ring-destructive` on inputs, `text-destructive` on error messages
- Delete confirm button: `bg-destructive hover:bg-destructive/90 text-foreground`; cancel: `bg-card border-border text-foreground hover:bg-muted`
- Select dropdowns: `bg-background border-border text-muted-foreground` for trigger, `focus:bg-card focus:text-foreground` for items
- Warning/info colours (yellow-*, blue-*) are semantic and intentionally NOT part of design token migration

---

# UX-1 Design System Foundation Progress Log

Started: 2026-02-05

---

## 2026-02-05 - US-001
- Replaced default shadcn/ui CSS variable values with Mjolnir palette in globals.css
- Background: zinc-950 (#09090b) → 240 6% 2%
- Card: zinc-900 (#18181b) → 240 6% 10%
- Elevated surfaces/borders: zinc-800 (#27272a) → 240 4% 16%
- Primary/accent: violet-500 (#8b5cf6) → 263 84% 66%
- Destructive: red-500 (#ef4444) → 0 84% 60%
- Added new variables: --positive (green-500), --negative (red-500), --accent-glow, --positive-glow, --negative-glow
- Made :root and .dark blocks identical (dark-mode only app)
- Files changed: app/globals.css
- **Learnings for future iterations:**
  - HSL values for Mjolnir palette: bg=240 6% 2%, card=240 6% 10%, elevated=240 4% 16%, primary=263 84% 66%, positive=142 71% 45%, destructive=0 84% 60%
  - Glow variables use rgba() format since box-shadow needs alpha channel, while colour variables use HSL space-separated format
  - :root and .dark blocks are identical — this is intentional for a dark-mode-only app
---

## 2026-02-05 - US-002
- Added semantic colour mappings to tailwind.config.ts: positive (DEFAULT + foreground), negative (DEFAULT + foreground)
- Added glow box-shadow utilities: shadow-glow-sm, shadow-glow-md, shadow-glow-lg, shadow-glow-positive, shadow-glow-negative
- Added card shadow utilities: shadow-card, shadow-card-hover
- All colour references use CSS variables via hsl(var(--*)); glow shadows use var(--*-glow) referencing rgba CSS variables
- Files changed: tailwind.config.ts
- **Learnings for future iterations:**
  - Glow shadows reference CSS variables directly (var(--accent-glow)) since the rgba values are stored in the CSS variable itself
  - Card shadows use rgba(0,0,0,*) for dark-mode-appropriate dark shadows — these are intentional raw rgba values for shadow opacity
  - Available Tailwind utility classes now: text-positive, bg-positive, text-negative, bg-negative, shadow-glow-sm/md/lg, shadow-glow-positive, shadow-glow-negative, shadow-card, shadow-card-hover
- Typography scale classes: text-display-xl, text-display-lg, text-display-md, text-heading-lg, text-heading-md, text-heading-sm, text-body-lg, text-body-md, text-body-sm, text-label
---

## 2026-02-05 - US-003
- Added typography scale to tailwind.config.ts under theme.extend.fontSize
- 10 size levels: display-xl (4rem) → label (0.75rem), each with lineHeight, fontWeight, and optional letterSpacing
- Uses Tailwind array syntax: ['size', { lineHeight, fontWeight, letterSpacing }]
- Added Inter font loading via next/font/google in app/layout.tsx (was NOT previously loaded despite progress log claiming so)
- Applied inter.className to body element
- Files changed: tailwind.config.ts, app/layout.tsx
- **Learnings for future iterations:**
  - Inter font was not loaded prior to this story — progress log said it was but it wasn't. Always verify claims in progress.txt against actual code
  - Typography scale uses Tailwind array syntax with object for compound values
  - Display sizes use negative letterSpacing for tighter headlines; label uses positive letterSpacing for readability at small size
---

## 2026-02-05 - US-004
- Created lib/theme.ts with layout constants and spacing constants
- Layout constants: sidebarWidth (240), rightPanelWidth (320), maxContentWidth (1400), cardRadius (16), buttonRadius (8), inputRadius (8)
- Spacing constants: xs (4), sm (8), md (16), lg (24), xl (32), 2xl (48) — following 8pt grid
- All values typed with `as const` for literal types; exported LayoutKey and SpacingKey type helpers
- Files changed: lib/theme.ts (new)
- **Learnings for future iterations:**
  - lib/theme.ts is the source of truth for layout dimensions and spacing — use these values rather than magic numbers
  - Constants are plain numbers (px) suitable for both Tailwind classes and inline styles
  - `as const` assertion gives literal types enabling type-safe consumption
---

## 2026-02-05 - US-005
- Installed framer-motion as a dependency (v12.x)
- Created lib/animations.ts exporting animation presets: fadeIn, slideUp, scaleIn, staggerContainer, staggerItem, numberSpring, springTransition
- Presets use Framer Motion's Variants and Transition types
- Individual presets (fadeIn, slideUp, scaleIn) export initial/animate/exit/transition — spread directly onto motion.div
- Stagger presets use Variants type with hidden/visible keys for parent-child orchestration
- numberSpring is a standalone Transition for animating numeric values
- Files changed: lib/animations.ts (new), package.json, package-lock.json
- **Learnings for future iterations:**
  - Animation presets are plain objects (not components) — spread onto motion elements: `<motion.div {...fadeIn}>`
  - Stagger presets use Variants type with "hidden"/"visible" keys — use with `variants` prop and `initial="hidden" animate="visible"` on parent
  - `satisfies Transition` is used inline where `as const` would narrow too aggressively for transition objects
  - framer-motion exports Variants and Transition as types (import type { ... })
---

## 2026-02-05 - US-006
- Created hooks/use-reduced-motion.ts re-exporting Framer Motion's useReducedMotion
- Created hooks/use-animation-config.ts with useAnimationConfig hook
- Hook accepts optional animation preset parameter (defaults to fadeIn)
- When prefers-reduced-motion is enabled: returns initial: false, transition: { duration: 0 }
- When disabled: returns standard animation props from the preset
- Uses Framer Motion's useReducedMotion which listens to matchMedia changes (re-evaluates on every render)
- Files changed: hooks/use-reduced-motion.ts (new), hooks/use-animation-config.ts (new)
- **Learnings for future iterations:**
  - Framer Motion's useReducedMotion returns boolean|null — it uses matchMedia internally and updates on changes
  - Setting initial: false tells Framer Motion to skip the initial animation (element starts in animate state)
  - Hooks go in hooks/ directory at project root (not in lib/)
  - "use client" directive is required for any file using React hooks or Framer Motion hooks
---

## 2026-02-05 - US-007
- Replaced hardcoded colour classes in app/layout.tsx and app/(dashboard)/layout.tsx with design tokens
- app/layout.tsx: bg-gray-950 → bg-background, text-white → text-foreground
- app/(dashboard)/layout.tsx: bg-gray-900 → bg-card, border-gray-800 → border-border, text-white → text-foreground
- Visual appearance unchanged (design token values map to same/similar colours)
- Files changed: app/layout.tsx, app/(dashboard)/layout.tsx
- **Learnings for future iterations:**
  - Mapping reference: bg-gray-950 → bg-background, bg-gray-900 → bg-card, border-gray-800 → border-border, text-white → text-foreground, text-gray-* → text-muted-foreground
  - The dashboard layout header uses bg-card (zinc-900) to visually elevate above bg-background (zinc-950)
  - Only 3 hardcoded colour classes existed in these two files — the layouts were already relatively clean
---

## 2026-02-05 - US-008
- Replaced all hardcoded Tailwind colour classes across 14 dashboard component files with design tokens
- Key mappings applied: border-gray-700 → border-border, bg-gray-800/50 → bg-card/50, bg-gray-700 (skeleton) → bg-muted, text-gray-400/500 → text-muted-foreground, text-white → text-foreground, text-green-500/emerald-400 → text-positive, text-red-500/400 → text-destructive, bg-gray-900 (tooltip) → bg-background, from-gray-800 to-gray-900 → from-card to-background
- Error states: border-red-700 bg-red-900/20 → border-destructive bg-destructive/10, text-red-400 → text-destructive
- Toggle active states: bg-gray-600 text-white → bg-muted text-foreground
- Toggle inactive: text-gray-400 hover:text-white → text-muted-foreground hover:text-foreground
- Intentionally preserved: category indicator colours (bg-blue-500, bg-purple-500, bg-orange-500, bg-emerald-500, bg-amber-500 in getAssetColor/getCurrencyColor), Recharts SVG hex values (stroke/fill props), and yellow-* warning theme classes
- Files changed: nav.tsx, mobile-nav.tsx, dashboard-header.tsx, summary-cards.tsx, net-worth-hero.tsx, net-worth-chart.tsx, top-performers.tsx, asset-allocation.tsx, asset-allocation-pie-chart.tsx, assets-vs-debt-chart.tsx, currency-exposure.tsx, super-growth-chart.tsx, super-breakdown-section.tsx, stale-data-warning.tsx
- **Learnings for future iterations:**
  - Recharts SVG props (stroke, fill) require raw hex values — CSS variables are not supported in SVG rendering
  - Category-specific colours (asset types, currencies) are intentionally hardcoded as they represent distinct data categories, not theme tokens
  - Warning/stale-data UI uses yellow-* Tailwind classes — these are semantic for warnings and not part of the grey-based design token migration
  - The codebase had a very consistent pattern for card containers: `border-gray-700 bg-gray-800/50` which maps cleanly to `border-border bg-card/50`
  - For skeleton loading states, `bg-gray-700` maps to `bg-muted` consistently
---

## 2026-02-05 - US-009
- Replaced all hardcoded Tailwind colour classes across 11 files in components/holdings/ and components/transactions/
- Holdings files changed (8): holdings-table.tsx, holding-price-chart.tsx, super-balance-history-chart.tsx, delete-holding-dialog.tsx, edit-holding-dialog.tsx, add-holding-dialog.tsx, currency-filter.tsx, group-by-selector.tsx
- Transaction files changed (3): delete-transaction-dialog.tsx, edit-transaction-dialog.tsx, add-transaction-dialog.tsx
- Key mappings applied: text-gray-300/400/500 → text-muted-foreground, text-white → text-foreground, bg-gray-900 → bg-background, bg-gray-800 → bg-card, bg-gray-700 → bg-muted, border-gray-700/800 → border-border, text-green-400/500 → text-positive, text-red-400/500 → text-destructive, border-red-500 → border-destructive, bg-red-600 → bg-destructive, bg-green-900 text-green-300 → bg-positive/20 text-positive
- Select components (currency-filter, group-by-selector): bg-gray-900 → bg-background, focus:bg-gray-800 → focus:bg-card, focus:text-white → focus:text-foreground
- Intentionally preserved: yellow-* warning colours, blue-* info colours, Recharts SVG hex values, text-yellow-400 stale data indicators
- **Learnings for future iterations:**
  - Form validation errors use a consistent pattern: `border-destructive focus-visible:ring-destructive` on inputs + `text-destructive` on error `<p>` tags
  - Select components use `focus:ring-destructive` (not focus-visible:) since SelectTrigger doesn't support focus-visible prefix the same way
  - Delete confirmation buttons: `bg-destructive hover:bg-destructive/90 text-foreground` with cancel buttons using `bg-card border-border text-foreground hover:bg-muted`
  - Dividend totals and positive values should use `text-positive` (not text-green-500)
  - Info boxes (like split explanation) use blue-* which are intentional semantic colours, not grey-based theme tokens
---
