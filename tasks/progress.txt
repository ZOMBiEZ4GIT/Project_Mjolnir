## Codebase Patterns
- Project uses Next.js 16+ App Router with TypeScript
- Drizzle ORM is already installed (`drizzle-orm`, `drizzle-kit`, `@neondatabase/serverless`)
- shadcn/ui components available in `components/ui`
- Dark mode only - no light mode support
- Quality checks: `npm run build` and `npm run lint`
- ESLint 9 with flat config format (eslint.config.mjs) - do not use .eslintrc.json
- Next.js 16 doesn't have `next lint` command - use `eslint .` directly

- Database module uses lazy initialization via Proxy to avoid build-time errors when DATABASE_URL is not set
- ClerkProvider conditionally renders based on NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY to allow builds without Clerk keys
- Use `export const dynamic = "force-dynamic"` for pages/layouts that use Clerk components
- Dashboard routes at `/dashboard` and `/profile` are protected; landing page `/` is public
- Auth pages use `(auth)` route group; dashboard uses `(dashboard)` route group

- TanStack Query provider is in `components/providers/query-provider.tsx` - wrap layouts with QueryProvider
- ClerkProvider wrapper is in `components/providers/clerk-provider.tsx` - handles missing Clerk keys gracefully
- Use `useAuthSafe` hook from `lib/hooks/use-auth-safe.ts` for client-side auth state that works with/without Clerk

- Toast notifications use Sonner - import `toast` from `sonner` and use `toast.success()` / `toast.error()`
- Toaster component is in root layout; for dark mode only, hardcode `theme="dark"` in Sonner component

- Dashboard navigation uses `components/dashboard/nav.tsx` with usePathname for active state
- Settings page exists at `/settings` for user preferences
- Import page exists at `/import` for CSV imports

- Error Handling Patterns (from CLAUDE.md):
  - Price API down: Show last cached price with "as of X ago" badge
  - Unknown symbol: Show error on holding form, prevent save
  - Invalid ticker: Show validation error, suggest correct format (e.g., `.AX` for ASX)
  - Auth failure: Redirect to Clerk sign-in
  - DB error: Generic "something went wrong" + error logging

- Design Principles:
  - Dark mode only - no light mode
  - Information density - show meaningful data; minimize empty space
  - Scannable - key metrics visible without scrolling
  - Mobile responsive - usable on phone for quick balance checks

- Existing components:
  - shadcn/ui: Button, Input, Select, Table, Card, Progress, Tooltip, Switch, Dialog, Sheet
  - Chart components in `components/charts/`: ChartSkeleton, ChartError, ChartExportButton
  - Dashboard components with loading skeletons already implemented

- Tailwind responsive breakpoints: sm (640px), md (768px), lg (1024px), xl (1280px)
- Use responsive classes like `hidden md:block` or `grid-cols-1 md:grid-cols-2`

- Error boundary component at `components/error-boundary.tsx` - use for wrapping sections that might fail
- SectionErrorBoundary at `components/dashboard/section-error-boundary.tsx` - lighter weight, section-specific error handling
- DashboardContent at `components/dashboard/dashboard-content.tsx` - wraps all dashboard sections with error boundaries

---

# W-12 Polish & Error Handling Progress Log

Started: 2026-02-03

---

## 2026-02-03 - US-001
- Created reusable ErrorBoundary component at `components/error-boundary.tsx`
- React class component using getDerivedStateFromError and componentDidCatch
- Shows friendly Card-based error message with "Try again" button
- Logs errors to console for debugging
- Dark mode styling using existing Card and Button components
- Optional `fallback` prop for custom error UI
- Optional `onReset` callback for parent components
- Also exports `withErrorBoundary` HOC for wrapping components
- Files changed: `components/error-boundary.tsx` (created)
- **Learnings for future iterations:**
  - React error boundaries must be class components (cannot be function components)
  - Show error details in development mode only using `process.env.NODE_ENV`
  - Use existing shadcn/ui Card styling for consistency
---

## 2026-02-03 - US-002
- Added error boundary to dashboard layout
- Created `components/dashboard/dashboard-error-boundary.tsx` as client wrapper for layout
- Created `components/dashboard/section-error-boundary.tsx` for individual sections
- Created `components/dashboard/dashboard-content.tsx` to wrap all dashboard sections
- Updated `app/(dashboard)/layout.tsx` to wrap children in DashboardErrorBoundary
- Updated `app/(dashboard)/dashboard/page.tsx` to use DashboardContent component
- Each major section (Net Worth Hero, Summary Cards, Asset Allocation, Currency Exposure, Super Breakdown, Net Worth Chart, Top Performers, Check-in Prompt) has its own SectionErrorBoundary
- Files changed: `app/(dashboard)/layout.tsx`, `app/(dashboard)/dashboard/page.tsx` (modified), `components/dashboard/dashboard-error-boundary.tsx`, `components/dashboard/section-error-boundary.tsx`, `components/dashboard/dashboard-content.tsx` (created)
- **Learnings for future iterations:**
  - Use client wrapper component (DashboardErrorBoundary) to add client-side ErrorBoundary to server component layout
  - SectionErrorBoundary is lighter weight than main ErrorBoundary - smaller UI, section name prop
  - Extract dashboard sections into separate DashboardContent client component for fine-grained error handling
---

## 2026-02-03 - US-003
- Created global error page at `app/error.tsx`
- Next.js convention: error.tsx catches errors at the route level
- Uses Card component with destructive/error styling consistent with ErrorBoundary
- Shows "Something went wrong" message with Try again and Go to Dashboard buttons
- Logs errors to console via useEffect
- Shows error message in development mode only
- Files changed: `app/error.tsx` (created)
- **Learnings for future iterations:**
  - Next.js error.tsx must be a client component ("use client")
  - error.tsx receives `error` and `reset` props from Next.js
  - `reset()` function attempts to re-render the route segment
  - Use consistent styling with ErrorBoundary for cohesive error UX
---

## 2026-02-03 - US-004
- Created not-found page at `app/not-found.tsx`
- Next.js convention: not-found.tsx handles 404 responses
- Uses Card component with muted border styling (neutral, not error-colored)
- Shows "Page not found" message with "Go to Dashboard" link
- Consistent dark mode styling matching error.tsx
- Server component (no "use client" needed since no interactivity beyond Link)
- Files changed: `app/not-found.tsx` (created)
- **Learnings for future iterations:**
  - Next.js not-found.tsx can be a server component (unlike error.tsx)
  - Use neutral styling for 404 (border-muted) vs error styling (border-destructive)
  - Keep styling consistent across error pages for cohesive UX
---

